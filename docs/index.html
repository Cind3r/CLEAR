<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Hospital Price Finder (ZIP Radius + Procedure)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Mobile device detection and redirect handled in external JS -->
  <!-- d3 as global (ok inside module) -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Main application styles -->
  <link rel="stylesheet" href="css/hospital-price-finder.css">
</head>
<body>
  <header>
    <label>Configuration Type:
      <select id="config-type">
        <option value="service" selected>Service</option>
        <option value="revenue-code">Revenue Code</option>
      </select>
    </label>
    <label id="service-label">
      <select id="service">
        <option value="">(Select Group)</option>
      </select>
    </label>
    <label id="procedure-label" style="display: none;">Procedure (regex or code):
      <input id="q" placeholder="e.g. (MRI|70551)|^70551$" size="28"/>
    </label>
    <label>ZIP: <input id="zip" placeholder="e.g. 27587" size="8"/></label>
    <label>Radius:
      <select id="radius">
        <option value="10">10 mi</option>
        <option value="25" selected>25 mi</option>
        <option value="50">50 mi</option>
        <option value="100">100 mi</option>
        <option value="250">250 mi</option>
        <option value="500">500+</option>
      </select>
    </label>
    <label>Payer:
      <select id="payer">
        <option value="">All Payers</option>
      </select>
    </label>
    <button id="go">Search</button>
    <span id="status"></span>
  </header>

  <main>
    <div class="map-container">
      <svg id="map" viewBox="0 0 960 600" aria-label="US map"></svg>
      <button id="reset-zoom" class="reset-zoom-btn">üîç Reset Zoom</button>
    </div>
    <aside>
      <h3 id="list-title">Hospitals (0)</h3>
      <div class="small">Shows hospitals within the radius; price hits appear under each.</div>
      <label style="display: block; margin: 0.5rem 0; font-size: 14px;">
        <input id="unit" type="checkbox" /> Show as ratio-to-Medicare
      </label>
      <div id="list"></div>
    </aside>
  </main>

  <div class="visualization-section">
    <div class="viz-container">
      <div class="viz-panel">
        <h3>Price Distribution</h3>
        <svg id="distribution-chart" class="viz-svg"></svg>
      </div>
      <div class="viz-panel">
        <h3>Hospital Price Comparison</h3>
        <svg id="slopegraph-chart" class="viz-svg"></svg>
      </div>
    </div>
  </div>

  <div class="info-section">
    <div class="info-container">
      <h2>About This Tool</h2>
      <p>The <strong>Hospital Price Finder</strong> helps you discover and compare healthcare procedure costs across hospitals within a specified radius of any ZIP code. Search by procedure codes (CPT, HCPCS) or custom patterns to find pricing transparency data from hospital charge masters.</p>
      
      <div class="plot-explanations">
        <div class="plot-explanation">
          <h3>üìä Price Distribution Chart</h3>
          <p>Shows the frequency distribution of all individual price points found for your search. This histogram displays every price entry (estimated amounts, minimum charges, maximum charges) from all matching procedures across all hospitals. Each bar represents how many procedures fall within that price range, giving you an overview of the overall pricing landscape.</p>
        </div>
        
        <div class="plot-explanation">
          <h3>üìà Hospital Price Comparison (Slope Chart)</h3>
          <p>Compares average minimum vs. maximum prices per hospital. Each colored line represents one hospital, connecting the average of all minimum prices (left) to the average of all maximum prices (right) for matching procedures. Hover over lines to see hospital names and exact values.</p>
          
          <div class="technical-note">
            <h4>üìã Data Calculation Details</h4>
            <ul>
              <li><strong>Slope Chart:</strong> Averages multiple procedures per hospital into single min/max values</li>
              <li><strong>Sidebar:</strong> Shows individual procedure records with specific min/max prices</li>
              <li><strong>Histogram:</strong> Plots every individual price point from all procedures</li>
            </ul>
            <p><em>Note: If a hospital appears in multiple matching procedures, the slope chart shows averages while the sidebar displays each individual procedure separately. This explains why slope chart values may not exactly match individual sidebar entries.</em></p>
          </div>
        </div>
      </div>
      
      <div class="usage-guide">
        <h3>üîç How to Use</h3>
        <ol>
          <li>Select a predefined service or enter a custom procedure pattern (regex supported)</li>
          <li>Enter a ZIP code and choose your search radius</li>
          <li>Optionally filter by insurance payer or view prices as ratios to Medicare rates</li>
          <li>Click search to see hospitals on the map and pricing data in the sidebar</li>
          <li>Scroll down to analyze price distributions and hospital comparisons</li>
          <li>Use the reset zoom button to return to the full map view</li>
        </ol>
      </div>
    </div>
  </div>

  <!-- 
    Main application JavaScript - handles all functionality including:
    - Mobile device detection and redirect (redirects to index-mobile.html if needed)
    - Map visualization with D3.js (US map with zoom, hospital markers, search radius circles)
    - Hospital search and filtering (geographic radius search, procedure/service matching)
    - Price data loading and display (JSON file parsing, price table generation)
    - Interactive visualizations (price distribution histogram, hospital comparison slope chart)
    - Configuration management (service vs revenue code patterns, payer filtering)
    - Event handling (search form, map interactions, hospital detail toggles)
  -->
  <script type="module" src="js/hospital-price-finder.js"></script>
</body>
</html>

  